{"version":3,"file":"preact.js","sources":["src/lib/diff.js","src/main.js","src/lib/helpers.js","src/bindings/preact.js"],"sourcesContent":["function isDifferent(a, b) {\n  if (!a && !b) return typeof a === typeof b\n  if (a === b) return false\n  if ((!a && b) || (a && !b)) return true\n  if (typeof a !== typeof b) return true\n  if (Array.isArray(a)) return compareArray(a, b, isDifferent)\n  if (typeof a === 'object') return compareObj(a, b, isDifferent)\n  if (!a && !b) return typeof a === typeof b\n  return true\n}\n\nfunction compareArray(a, b, recursion) {\n  if (!Array.isArray(b)) return true\n  if (a.length !== b.length) return true\n  if (a.length === 0 && b.length === 0) return false\n  return a.filter((item, idx) => recursion(item, b[idx])).length !== 0\n}\n\nfunction compareObj(a, b, recursion) {\n  const aKeys = Object.keys(a)\n  const bKeys = Object.keys(b)\n  if (aKeys.length !== bKeys.length) return true\n  return (\n    aKeys.filter(\n      (key, idx) => (key === bKeys[idx] ? recursion(a[key], b[key]) : false)\n    ).length !== 0\n  )\n}\n\nexport { isDifferent }\n","import { isDifferent } from './lib/diff'\nimport { createActions } from './lib/helpers'\n\nconst stateManager = (initialState = {}, _actions = {}) => {\n  let state = initialState\n  let connections = []\n\n  const emit = () => connections.forEach(c => c(state, actions))\n\n  const getState = mapStateToProps =>\n    mapStateToProps ? mapStateToProps(state) : state\n\n  const getActions = mapDispatchToProps =>\n    mapDispatchToProps ? mapDispatchToProps(actions) : actions\n\n  const setState = newState => {\n    if (newState !== undefined && isDifferent(state, newState)) {\n      state = newState\n      emit()\n    }\n  }\n\n  const actions = createActions(_actions, getState, dispatch, setState)\n\n  function dispatch(actionType, ...args) {\n    setState(actions[actionType](...args))\n  }\n\n  const dispose = connection => {\n    connections = connections.filter(c => c !== connection)\n  }\n\n  return {\n    getState,\n    getActions,\n    actions,\n    connect: (mapStateToProps, mapActionsToProps) => {\n      let prevRes = mapStateToProps ? mapStateToProps(state) : state\n      return consumer => {\n        const connection = (state, actions) => {\n          const currentRes = getState(mapStateToProps)\n          if (isDifferent(prevRes, currentRes)) {\n            prevRes = currentRes\n            consumer(Object.assign({}, currentRes, getActions(mapActionsToProps)))\n          }\n        }\n        connections.push(connection)\n        return {\n          dispose: () => dispose(connection)\n        }\n      }\n    }\n  }\n}\n\nexport { stateManager }\n","const mapObj = (r, fn) => {\n  const o = {}\n  for (let v in r) o[v] = fn(r[v])\n  return o\n}\n\nconst createActions = (actions, state, dispatch, setState) => {\n  return mapObj(actions, fn => (...args) => {\n    return setState(fn(state(), dispatch)(...args))\n  })\n}\n\nexport { mapObj, createActions }\n","import { h, Component } from 'preact'\n\nexport const connect = (store, mapStateToProps, mapDispatchToProps) => {\n  return function(WrappedComponent)  {\n    return class extends Component {\n      constructor() {\n        super()\n        this.connection = null\n        this.handleUpdate = this.handleUpdate.bind(this)\n        this.state =\n          Object.assign(\n            {},\n            store.getState(mapStateToProps),\n            store.getActions(mapDispatchToProps)\n          )\n      }\n\n\n      componentDidMount() {\n        this.connection = store.connect(mapStateToProps, mapDispatchToProps)(\n          this.handleUpdate\n        )\n      }\n      handleUpdate(state) {\n        this.setState(Object.assign({}, state))\n      }\n\n      componentWillUnmount() {\n        this.connection && this.connection.dispose()\n      }\n      render() {\n        return h(WrappedComponent, this.state)\n      }\n    }\n  }\n}\n"],"names":["isDifferent","a","b","Array","isArray","recursion","length","filter","item","idx","compareArray","const","aKeys","Object","keys","bKeys","key","compareObj","initialState","_actions","let","state","connections","getState","mapStateToProps","getActions","mapDispatchToProps","actions","setState","newState","undefined","forEach","c","dispatch","r","fn","o","v","mapObj","args","createActions","actionType","connect","mapActionsToProps","prevRes","consumer","connection","currentRes","assign","push","dispose","store","WrappedComponent","super","this","handleUpdate","bind","componentDidMount","componentWillUnmount","render","h","Component"],"mappings":"wBAAA,SAASA,EAAYC,EAAGC,GACtB,OAAKD,GAAMC,EACPD,IAAMC,QACJD,GAAKC,GAAOD,IAAMC,YACbD,UAAaC,IACpBC,MAAMC,QAAQH,GAMpB,SAAsBA,EAAGC,EAAGG,GAC1B,IAAKF,MAAMC,QAAQF,GAAI,OAAO,EAC9B,GAAID,EAAEK,SAAWJ,EAAEI,OAAQ,OAAO,EAClC,GAAiB,IAAbL,EAAEK,QAA6B,IAAbJ,EAAEI,OAAc,OAAO,EAC7C,OAAmE,IAA5DL,EAAEM,gBAAQC,EAAMC,UAAQJ,EAAUG,EAAMN,EAAEO,MAAOH,OAV3BI,CAAaT,EAAGC,EAAGF,GAC/B,iBAANC,EAYb,SAAoBA,EAAGC,EAAGG,GACxBM,IAAMC,EAAQC,OAAOC,KAAKb,GACpBc,EAAQF,OAAOC,KAAKZ,GAC1B,GAAIU,EAAMN,SAAWS,EAAMT,OAAQ,OAAO,EAC1C,OAGe,IAFbM,EAAML,gBACHS,EAAKP,UAASO,IAAQD,EAAMN,IAAOJ,EAAUJ,EAAEe,GAAMd,EAAEc,MACxDV,OAnB8BW,CAAWhB,EAAGC,EAAGF,MAC9CC,IAAMC,WAAiBD,UAAaC,YANbD,UAAaC,gCCErBgB,EAAmBC,yCACvCC,IAAIC,EAAQH,EACRI,KAIEC,WAAWC,UACfA,EAAkBA,EAAgBH,GAASA,GAEvCI,WAAaC,UACjBA,EAAqBA,EAAmBC,GAAWA,GAE/CC,WAAWC,QACEC,IAAbD,GAA0B7B,EAAYqB,EAAOQ,KAC/CR,EAAQQ,EAVOP,EAAYS,iBAAQC,UAAKA,EAAEX,EAAOM,OAe/CA,WChBeA,EAASN,EAAOY,EAAUL,mBANjCM,EAAGC,GACjBxB,IAAMyB,KACN,IAAKhB,IAAIiB,KAAKH,EAAGE,EAAEC,GAAKF,EAAGD,EAAEG,IAC7B,OAAOD,EAIAE,CAAOX,WAASQ,mFACdP,EAASO,EAAGd,IAASY,cAAU,EAAGM,ODc3BC,CAAcrB,EAAUI,EAExC,SAAkBkB,iEAChBb,EAASD,EAAQc,SAAYd,EAAGY,KAH0BX,GAU5D,gBACEL,aACAE,UACAE,EACAe,iBAAUlB,EAAiBmB,GACzBvB,IAAIwB,EAAUpB,EAAkBA,EAAgBH,GAASA,EACzD,gBAAOwB,GACLlC,IAAMmC,WAAczB,EAAOM,GACzBhB,IAAMoC,EAAaxB,EAASC,GACxBxB,EAAY4C,EAASG,KACvBH,EAAUG,EACVF,EAAShC,OAAOmC,UAAWD,EAAYtB,EAAWkB,OAItD,OADArB,EAAY2B,KAAKH,IAEfI,mCApBQJ,GACdxB,EAAcA,EAAYf,gBAAOyB,UAAKA,IAAMc,IAmBvBI,CAAQJ,kCE9CTK,EAAO3B,EAAiBE,UACvC,SAAS0B,GACd,gCAEIC,aACAC,KAAKR,WAAa,KAClBQ,KAAKC,aAAeD,KAAKC,aAAaC,KAAKF,MAC3CA,KAAKjC,MACHR,OAAOmC,UAELG,EAAM5B,SAASC,GACf2B,EAAM1B,WAAWC,oGAKvB+B,6BACEH,KAAKR,WAAaK,EAAMT,QAAQlB,EAAiBE,EAA/ByB,CAChBG,KAAKC,2BAGTA,sBAAalC,GACXiC,KAAK1B,SAASf,OAAOmC,UAAW3B,iBAGlCqC,gCACEJ,KAAKR,YAAcQ,KAAKR,WAAWI,uBAErCS,kBACE,OAAOC,IAAER,EAAkBE,KAAKjC,WA3BfwC"}